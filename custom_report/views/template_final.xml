<odoo>
    <template id="report_custom">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <style>
                        table {
                            border-collapse: collapse;
                            width: 100%;
                            font-family: Arial, sans-serif;
                        }
                        th, td {
                            border: 1px solid black;
                            text-align: center;
                            vertical-align: middle;
                            padding: 6px;
                        }
                        .no-border {
                            border-bottom : none;
                            width: 30%;
                        }
                        .header {
                            font-size: 20px;
                            width: 70%;
                            font-weight: bold;
                            text-align: center;
                            background-color: #f4f4f4;
                        }
                        .sub-header {
                            width: 15%;
                            font-size: 16px;
                            font-weight: bold;
                            background-color: #f4f4f4;
                        }
                        .sub-header-2 {
                            font-size: 16px;
                            font-weight: bold;
                            text-align: left;
                            background-color: #f4f4f4;
                        }
                        .bold-text {
                            font-weight: bold;
                        }
                        .checklist-table th, .checklist-table td {
                            text-align: left;
                            padding: 8px;
                        }
                        .checklist-table th {
                            background-color: #f4f4f4;
                        }
                        .checklist-category {
                            font-weight: bold;
                            background-color: #f4f4f4;
                            text-align: left;
                            padding-left: 10px;
                            
                        }
                        table + table {
                            margin-top: 0;
                        }
                        tr {
                            margin: 0;
                            padding: 0;
                        }
                    </style>
                    <body>
                        <table>
                            <tr>
                                <td colspan="2" class="no-border">
                                    <img src="/custom_report/static/description/logo_vb.png" alt="Logo" width="90%"/>
                                </td>
                                <td colspan="8" class="header">SHREE VENKATESH BUILDCON</td>
                            </tr>
                            <tr>
                                <td class="sub-header">Project</td>
                                <td colspan="3">
                                    <t t-esc="o.name.name"/>
                                </td>
                                <td class="sub-header">Location</td>
                                <td colspan="3">
                                    <t t-esc="o.location"/>
                                </td>
                            </tr>
                            <tr>
                                <td class="sub-header">Building</td>
                                <td colspan="3">
                                    <t t-esc="o.tower_id.name"/>
                                </td>
                                <td class="sub-header">Print Date</td>
                                <td colspan="3">
                                    <t t-esc="o.date.strftime('%d-%m-%Y')"/>
                                </td>
                            </tr>
                            <tr>
                                <td class="sub-header">Flat</td>
                                <td colspan="3">
                                    <t t-esc="o.flat_id.name"/>
                                </td>
                                <td class="sub-header"></td>
                                <td colspan="3"></td>
                            </tr>
                            <tr>
                                <td class="sub-header">Floor</td>
                                <td colspan="3">
                                    <t t-esc="o.floor_id.name"/>
                                </td>
                                <td class="sub-header"></td>
                                <td colspan="3"></td>
                            </tr>
                        </table>

                        <table>
                            <tr>
                                <td colspan="4" style="border-top: none; border-right: none; padding: 6px; width: 20%;">QUALITY ASSURANCE CARD</td>
                                <td colspan="6" style="border-top: none;">
                                    <t t-esc="o.activity_id.name"/>
                                </td>
                            </tr>
                        </table>

                        <table>
                            <tr>
                                <td class="sub-header" style="border-top: none; border-bottom: none">Flat</td>
                                <td colspan="3" style="border-top: none; border-bottom: none">
                                    <t t-esc="o.flat_id.name"/>
                                </td>
                                <td class="sub-header" style="border-top: none; border-bottom: none">Floor</td>
                                <td colspan="3" style="border-top: none; border-bottom: none">
                                    <t t-esc="o.floor_id.name"/>
                                </td>
                            </tr>
                        </table>

                        <table class="checklist-table">
                            <thead>
                                <tr>
                                    <th style="text-align: center; color: black;">Sr.No.</th>
                                    <th style="text-align: center; color: black;">Activity</th>
                                    <th style="text-align: center; color: black;">Maker<br/>
                                        (Yes/No/NA)</th>
                                    <th style="text-align: center; color: black;">Checker<br/>
                                        (Yes/No/NA)</th>
                                    <th style="text-align: center; color: black;">Approver<br/>
                                        (Yes/No/NA)</th>
                                    <th style="text-align: center; color: black;">Remarks</th>
                                </tr>
                            </thead>
                            <t t-set="checklist_lines" t-value="json.loads(o.checklines or '[]')"/>
                            <t t-set="activity_users" t-value="json.loads(o.activity_users or '[]')"/>
                            <t t-set="prev_act_name" t-value="None"/>

                            <t t-foreach="checklist_lines" t-as="line" t-index="index">

                                <t t-if="line['act_name'] != prev_act_name">
                                    <tr>
                                        <td colspan="2" class="checklist-category" style="text-transform: uppercase; border-right:none;">
                                            <strong>
                                                <t t-esc="line['act_name']" style="font-size: 16px"/>
                                            </strong>
                                        </td>
                                        <td colspan="4" class="checklist-category" style="text-align: right; border-left:none;">
                                            <!-- <span style="margin-left: 450px;"></span> -->
                                            <strong>Submitted On:<t t-esc="line['submitted_date']" style="font-size: 14px"/>
                                            </strong>
                                        </td>
                                    </tr>
                                    <t t-set="prev_act_name" t-value="line['act_name']"/>


                                    <t t-set="activity_users_for_current" t-value="[user for user in activity_users if user['activity_name'] == line['act_name']]"/>
                                    <t t-if="activity_users_for_current">

                                    </t>
                                </t>

                                <tr>
                                    <td>
                                        <t t-esc="line['index']"/>
                                    </td>
                                    <td>
                                        <t t-esc="line['name']"/>
                                    </td>
                                    <td>
                                        <t t-esc="'Yes' if line['is_pass'] == 'yes' else 'No'"/>
                                    </td>
                                    <td>
                                        <t t-esc="'Yes' if line['is_pass'] == 'yes' else 'No'"/>
                                    </td>
                                    <td>
                                        <t t-esc="'Yes' if line['is_pass'] == 'yes' else 'No'"/>
                                    </td>
                                    <td>
                                        <t t-esc="line['reason'] or 'N/A'"/>
                                    </td>
                                </tr>
                                <t t-if="line['temp'] == 'true'">

                                    <tr>
                                        <td>
                                            <strong>Maker: </strong>
                                        </td>
                                        <td colspan="5">
                                            <t t-esc="activity_users_for_current[0]['user_maker'] or ''"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>Checker: </strong>
                                        </td>
                                        <td colspan="5">
                                            <t t-esc="activity_users_for_current[0]['user_checker'] or ''"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>Approver: </strong>
                                        </td>
                                        <td colspan="5">
                                            <t t-esc="activity_users_for_current[0]['user_approver'] or ''"/>
                                        </td>
                                    </tr>
                                </t>
                            </t>

                        </table>
                    </body>
                </t>
            </t>
        </t>
    </template>
</odoo>
